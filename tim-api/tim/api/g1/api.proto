syntax = "proto3";

import "google/protobuf/timestamp.proto";

package tim.api.g1;

message Timite {
  uint64 id = 1;
  string nick = 2;
}

message ClientInfo {
  string platform = 1;
}

message Session {
  string id = 1;
  google.protobuf.Timestamp created_at = 2;
}

message SpaceUpdate {
  string id = 1;
  oneof event {
    SpaceNewMessage space_new_message = 7;
  }
}

message Message {
  string sender_id = 1;
  string content = 2;
}

message SpaceNewMessage {
  Message message = 1;
}

message AuthenticateReq {
  Timite timite = 1;
  ClientInfo client_info = 2;
}

message AuthenticateRes {
  Session session = 1;
}

message SendMessageReq {
  string id = 1;
  string command = 2;
  string client_id = 3;
}

message SendMessageRes {
  string id = 1;
}

message SubscribeToSpaceReq {
  string client_id = 1;
}

service TimApi {
  rpc Authenticate(AuthenticateReq) returns (AuthenticateRes);
  rpc SendMessage(SendMessageReq) returns (SendMessageRes);
  rpc SubscribeToSpace(SubscribeToSpaceReq) returns (stream SpaceUpdate);
}
