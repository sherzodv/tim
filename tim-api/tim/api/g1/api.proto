syntax = "proto3";

import "google/protobuf/timestamp.proto";

package tim.api.g1;

message Timite {
  uint64 id = 1;
  string nick = 2;
}

message ClientInfo {
  string platform = 1;
}

message Session {
  uint64 id = 1;
  google.protobuf.Timestamp created_at = 2;
}

message Message {
  uint64 id = 1;
  uint64 sender_id = 2;
  string content = 3;
}

// --[ Updates: Space updates ]--

message SpaceUpdate {
  uint64 id = 1;
  oneof event {
    SpaceNewMessage space_new_message = 7;
  }
}

message SpaceNewMessage {
  Message message = 1;
}

// --[ RPC req/res ]--

message Error {
  uint64 code = 1;
  string description = 2;
}

message AuthenticateReq {
  Timite timite = 1;
  ClientInfo client_info = 2;
}

message AuthenticateRes {
  Session session = 1;
}

message SendMessageReq {
  string content = 2;
}

message SendMessageRes {
  optional Error error = 1;
}

message SubscribeToSpaceReq {
   bool receive_own_messages = 1;
}

service TimApi {
  rpc Authenticate(AuthenticateReq) returns (AuthenticateRes);
  rpc SendMessage(SendMessageReq) returns (SendMessageRes);
  rpc SubscribeToSpace(SubscribeToSpaceReq) returns (stream SpaceUpdate);
}
